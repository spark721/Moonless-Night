<link rel="stylesheet" type="text/css" href="/client/stylesheets/index.css">
<script src="/client/images/fire/medium_fire.js"></script>
<script src="/client/images/stalker/stalker_sprite.js"></script>


<!-- <body class="body" background="/client/images/background/bk_forest_night.png"> -->
  
<canvas background="/client/images/background/bk_forest_night.png" id='ctx' width='1400' height='788' style='border:1px solid black'></canvas>


<script src="/socket.io/socket.io.js"></script>
<script>
  const ctx = document.getElementById('ctx').getContext('2d');
  ctx.font = '30px Arial';

  ctx.fillStyle = "#FFFFFF";

  const socket = io();
  
  socket.on('pack', data => {
    // clear canvas
    ctx.clearRect(0, 0, 1400, 750);
    for (let i = 0; i < data.player.length; i++) {
      ctx.fillText(data.player[i].state, data.player[i].x, data.player[i].y) 
    }
    ctx.fillText(`${data.fire.firePower}`, 700, 100);
    
    
    // render trees
    for (let i = 0; i < data.tree.length; i++) {
      let tree = data.tree[i];
      
      if(tree.logs > 0) {
        ctx.beginPath();
        ctx.arc(tree.x, tree.y, tree.size, 0, 2 * Math.PI);
        ctx.stroke();
        
        const treeImage = new Image();
        
        treeImage.src = `/client/images/trees/${(tree.id % 4) + 1}${tree.logs}.png`;
        ctx.drawImage(treeImage, tree.x-50 * (tree.logs/6 + 0.5), tree.y-175 * (tree.logs/6 + 0.5), 100 * (tree.logs/6 + 0.5), 200 * (tree.logs/6 + 0.5));
      }
    } 
    
    //specter
    for (let i = 0; i < data.specter.length; i++) {
      ctx.fillStyle = "#3370d4";
      ctx.beginPath();
      ctx.arc(data.specter[i].x, data.specter[i].y, data.specter[i].size, 0, 2 * Math.PI);
      ctx.closePath();
      ctx.fill();
      ctx.stroke();  
    
    }    
    //stalker
    for (let i = 0; i < data.stalker.length; i++) {
      ctx.fillStyle = "#c82124";
      ctx.beginPath();
      ctx.arc(data.stalker[i].x, data.stalker[i].y, data.stalker[i].size, 0, 2 * Math.PI);
      // stalkerDrawImage(data.stalker[i].x, data.stalker[i].y);
      ctx.closePath();
      ctx.fill();
      ctx.stroke();  
    }    
    //log
    for (let i = 0; i < data.log.length; i++) {
      ctx.fillStyle = "brown";
      ctx.beginPath();
      ctx.arc(data.log[i].x, data.log[i].y, data.log[i].size, 0, 2 * Math.PI);
      ctx.closePath();
      ctx.fill();
      ctx.stroke();  
    }    
    //torch
    for (let i = 0; i < data.torch.length; i++) {
      ctx.fillStyle = "orange";
      ctx.beginPath();
      ctx.arc(data.torch[i].x, data.torch[i].y, data.torch[i].size, 0, 2 * Math.PI);
      ctx.closePath();
      ctx.fill();
      ctx.stroke();  
    }    
    ctx.fillStyle = "rgba(255, 255, 255, 0)";
    medFireDrawImage();
    ctx.fillStyle = "rgba(255, 255, 255, 0)";
    ctx.fillStyle = "#FFFFFF";
    
  })

  document.onkeydown = event => {
    if (event.keyCode === 68) socket.emit('keyPress', {inputId: 'right', state: true}); // d
    if (event.keyCode === 65) socket.emit('keyPress', {inputId: 'left', state: true}); // a
    if (event.keyCode === 87) socket.emit('keyPress', {inputId: 'up', state: true}); // w
    if (event.keyCode === 83) socket.emit('keyPress', {inputId: 'down', state: true}); // s
    if (event.keyCode === 74) socket.emit('keyPress', {inputId: 'chop', state: true });
    if (event.keyCode === 75) socket.emit('keyPress', {inputId: 'drop', state: true });
  }

  document.onkeyup = event => {
    if (event.keyCode === 68) socket.emit('keyPress', {inputId: 'right', state: false});
    if (event.keyCode === 65) socket.emit('keyPress', {inputId: 'left', state: false});
    if (event.keyCode === 87) socket.emit('keyPress', {inputId: 'up', state: false});
    if (event.keyCode === 83) socket.emit('keyPress', {inputId: 'down', state: false});
    if (event.keyCode === 74) socket.emit('keyPress', {inputId: 'chop', state: false });
    if (event.keyCode === 75) socket.emit('keyPress', {inputId: 'drop', state: false });
  }
</script>
</body>